---
slug: "rromeo"
title: Access Publisher Copyright & Self-Archiving Policies via the 'SHERPA/RoMEO' API
package_version: 0.1.0
authors:
  - Matthias Greni√©
  - Hugo Gruson
date: '2019-6-4'
categories: blog
topicid:
tags:
- Software Peer Review
- R
- community
- software
- packages
- rromeo
- SHERPA/RoMEO
- API
- open access
- scientific publications
- preprint
- postprint
---

We've been following rOpenSci for a long time, using several packages in our scientific projects, especially [`taxize`](https://github.com/ropensci/taxize/) to clean species names, [`rredlist`](https://github.com/ropensci/rredlist/) to extract species IUCN statuses or [`treeio`](https://github.com/ropensci/treeio) to work with phylogenetic trees. The thorough package review process greatly improves the quality of the packages that join the rOpenSci ecosystem. It is a great community to learn and develop new ideas, especially regarding scientific packages.
As we admired the dynamics of rOpenSci community, we wanted to contribute to this ecosystem. So we first thought about the kind of project that could fit rOpenSci goals and that could, in the same time, teach us new things.
As young researchers, we know how much a scientific article can benefit from a detailed and helpful review. We were really curious to see what kind of new outlook on our work reviewers would bring here.

Open Access is the idea that scientific articles should be accessible to anyone to favour scientific dissemination, as well as public information. Open Access is rising in the scientific community with more and more public funding agencies requiring funded projects to make their article open access. Several models exist to foster Open Access. One way that open access can be done is the so-called ["green open-access"](https://en.wikipedia.org/wiki/Open_access#Green_OA) meaning that the articles are deposited by their authors and made publicly available through institutional or public repositories, such as [bioRxiv](https://www.biorxiv.org) or [HAL](https://hal.archives-ouvertes.fr/). Scientific journals have different policies regarding green open-access: some of them let you archive different versions of the manuscript right after acceptance while some others ask you to wait an embargo period, some forbid entirely the archival of the manuscript. In order to favour open-access of article scientists can choose to publish in journals that authorize such archival. That's where [SHERPA/RoMEO](http://sherpa.ac.uk/romeo/index.php) comes in handy, SHERPA/RoMEO is a publicly available database of open access policies of scientific journals. It indexes the conditions at which each journal let you (or not) host manuscript versions.

The SHERPA/RoMEO database is available through an [Application Programming Interface](https://en.wikipedia.org/wiki/Application_Programming_Interface) (API), so we thought we could build an R client to this API to make it accessible for individual scientists. With that researchers could more easily select journals based on their manuscript archival policies. Also these data can be used by bibliometricians to get the general picture of open access practices among journals of a particular subfield.

We had no prior experience working with web data or scrapping APIs for data but we knew that several tools in R existed to interact with APIs such as @hadley [`httr`](https://cran.r-project.org/package=httr), @sckott [`crul`](https://cran.r-project.org/package=crul) and many examples of R client for APIs available on the CRAN Task View on [Web Technologies](https://cran.r-project.org/web/views/WebTechnologies.html). So that is how we decided to begin the development of `rromeo`.

### SHERPA/RoMEO API

SHERPA/RoMEO has been available through a web interface since February 2004 according to the [Internet Archive](https://archive.org/). Their API has been available since December 2006 (from the Internet Archive <https://web.archive.org/web/20061211125806/http://www.sherpa.ac.uk:80/romeo.php>). Making their data available to anyone since then. However, at that time the API standards hadn't diffused as much as today. The development of the RoMEO API seems to have stopped since 2013 even though the database is still updated. There is even a [wishlist of functionalities regarding the API](http://sherpa.ac.uk/romeo/API-Wishlist-2012-10.html), that does not seem to be updated anymore.

The API grants you access to the archival policies of scientific journals and let you know whether the publisher accepts that authors archive different versions of the manuscripts. There are three versions of the manuscript considered in SHERPA/RoMEO:
1. pre-print, which is the manuscript version **before peer-review**;
1. post-print, which is the manuscript as **accepted after peer-review** but not yet typeset as an article in the journal;
1. and typeset manuscript/publisher's manuscript, which is the manuscript with the text after peer-review **fully typeset** as it appears in the journal.
Depending on the journal some accept the archival only of the pre-print, while others accept both pre-print and post-print, and some journal even accept the archival of all three versions!
SHERPA/RoMEO's API let you know what is the policy of a journal using its name and whether restrictions apply such as embargo period before publicly archiving different manuscript versions.

One difficulty arose during the development of `rromeo` from the fact that the API does not always follow modern web standards. This meant that some R packages could not be readily used but needed small adjustments first, e.g. the encoding of the returned query was latin-1 instead of the now common UTF-8 and this was not well declared via header of the query. Furthermore the SHERPA/RoMEO is not [RESTful](https://en.wikipedia.org/wiki/Representational_state_transfer) and thus the query needed were a little more complex to design. Fortunately the developers had written a [full documentation](http://www.sherpa.ac.uk/romeo/apimanual.php?la=en&fIDnum=|&mode=simple#versions) of all different types of query possible to run.

The API returned XML document that we decided to parse using the `xml2` package.

Difficulty of the API that does not output all the information regarding a single journal when querying it -> Recursive function but

### rromeo: an R API client

`rromeo` let's you access basic information regarding the journal policies.
You can access the policy of journal with its title using the function `rr_journal_name()`:

```r
rromeo::rr_journal_name("Methods in Ecology and Evolution")
```
```
                              title      issn romeocolour preprint
 1 Methods in Ecology and Evolution 2041-210X      yellow      can
    postprint    pdf pre_embargo post_embargo pdf_embargo
 1 restricted cannot        <NA>    12 months        <NA>
```

We see that Methods in Ecology and Evolution allows the archival of pre-print manuscripts, it also allows the archival of post-print manuscripts with restrictions but it does not allow the archival of the typeset manuscript (`pdf` column). A 12 months embargo is needed before the public archival of post-print manuscripts (`post_embargo` column).

`rromeo` also let's you access to several journals by matching the beginning of the title using the argument `qtype = "starts"`:

``` r
rromeo::rr_journal_name("Bird", qtype = "starts")
``` 

```
4 journals match your query terms.
Recursively fetching data from each journal. This may take some time...
                            title      issn romeocolour preprint postprint
1                   Bird Behavior 0156-1383        blue   cannot    cannot
2 Bird Conservation International 0959-2709       green      can       can
3                Bird Populations 1074-1755        <NA>     <NA>      <NA>
4                      Bird Study 0006-3657       green      can       can
     pdf pre_embargo post_embargo pdf_embargo
1    can        <NA>         <NA>        <NA>
2 cannot        <NA>         <NA>        <NA>
3   <NA>        <NA>         <NA>        <NA>
4 cannot        <NA>         <NA>        <NA>
```

We see that different journals have very different policies regarding their manuscript archival policy. 

`rromeo` can also retrieve publisher's information:
``` r
rromeo::rr_publisher_name("Oxford University Press")
```
```
   romeoid               publisher alias romeocolour preprint  postprint
 1      55 Oxford University Press   OUP      yellow      can restricted
       pdf
 1 unclear
```

Which gives you the general policy of Oxford University Press regarding manuscript archival. Some restrictions may apply depending on the precise branch of the publisher you plan to publish in, so always double check before archiving your manuscripts.

You can get a full overview of `rromeo` capabilities reading the [introductory vignette](https://docs.ropensci.org/rromeo/articles/rromeo.html).


### Developing an API package: lessons learned

As we had no prior experience working with web technologies within R we learned a lot during `rromeo`'s development process. We decided to use `httr` to handle the queries and followed its best practices vignettes about [building API packages](https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html). We preferred the use of `httr` of rOpenSci `crul` package for its even higher-level of use as `httr` hides even more details on how it handles the query compared to `crul`.

We wanted to follow the best development practices such as having unit tests that check the behavior of functions in the package. But how can you get unit tests when you need to be connected to the internet to use the package? The answer is **mocking**. Basically you create fake requests stored locally that lets you check your functions.
@sckott's [vcr] exactly suited for that. With `vcr` you record your requests and replay them for your tests (learn more about it in [the technote about vcr](https://ropensci.org/technotes/2018/05/25/vcr-http-request-cacahing/)). We used it in `rromeo` for all the tests as well as for caching the examples shown in the README file. The [companion book](https://ropenscilabs.github.io/http-testing-book/) on HTTP testing helped dive into the different options suitable to record our requests.

The SHERPA/RoMEO API offers to use API keys to get unlimited access to the API. Setting API keys when using APIs is good practice to let the owners track usage. `rromeo` provides several ways to set up an API key after registering it: a `key` argument in all functions, setting up an environmental variable in the session, using an `.Renviron` or an `.Rprofile` file. All of which are summarized in the [API key vignette](https://docs.ropensci.org/rromeo/articles/setting_up_api_key.html). Our first explanation on how to setup an API key was difficult to understand and only in the function help files. We thank both our reviewers @ottlngr and @brunaw for suggesting us to write a full vignette regarding API keys. Thanks to their comments we also wrote the `rr_auth()` function that writes the key as an environmental variable. There may be room for improvement regarding the security of the API key. However, in our case, the access to the API is not very sensitive so we think it is good enough.

Similar to setting up an API key, setting a user-agent when doing web-scraping is good practice to let the owners of the website/API from which kind of software the requests come from. @brunaw pointed that we had forgotten to setup a user-agent even if it was specified in the [`httr` best practices vignette](https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html). We tweaked our requests using `httr::add_headers("user-agent" = ...)` to add a user-agent with a custom defined string that sends to the github page of the package and returns its version.

To check that the user-agent was well defined we used the awesome website <https://httpbin.org/> which is simple HTTP request & response service. It is very useful to test prototype query and make sure you get back what you wanted. We used <https://httpbin.org/user-agent> with our custom specified header to make sure we had set up the user-agent correctly. We do recommend using httpbin.org services to prototype requests and test the passing of arguments.

Because all packages are in the end made for users, it is always important to think about the interface you want to expose to your users. We first had a single function `rr_journal_name()` with a Boolean argument called `multiple`, based on the value of this argument and what the API returned the structure of what `rr_journal_name()` returned was inconsistent as both our reviewers noticed. They suggested to split the function in two different functions that had consistent output: `rr_journal_name()`  that would return all the information regarding policies and `rr_journal_find()` that would return simply the title as well as the ISSN of the journal if found. Having the external view of the reviewers helped us take a step back regarding the functions we were exposing to the users.

While working on `rromeo`, we realized that one of the major difficulties of developing an R API package was to decide the level of details offered to the user: if too high level, not flexible enough; if too low level, intractable. We were greatly inspired by the many packages developed by Scott Chamberlain that sometimes offer two different interfaces for different kind of users (see [rredlist] for example). This strategy may be useful to offer different kind of granularity of information on details depending on the future use of the API information.

One issue with APIs that return data is how to communicate the license to the user. SHERPA/RoMEO returns a [license](http://www.sherpa.ac.uk/romeoreuse.html) in each request but we didn't wanted to flood the user with license information. That's why we included a citation information in the CITATION file of the package accessible using `citation("rromeo")`. It may not be ideal

There exist many resources to develop API packages that we recommend to people who would like to develop one:
   * [httr] vignette,
   * @sckott [HTTP Testing book](https://ropensci.github.io/http-testing-book/)
   * the sources of the API packages developed among rOpenSci among which, [rredlist], [`rplos`](https://github.com/ropensci/rplos) and many others,
   * the CRAN Task View on [Web Technologies and Services](https://cran.r-project.org/web/views/WebTechnologies.html) to see even more examples of API packages and tools that can be used to build them.
   
### Giving back to the community

[vcr] and [webmockr] are recent rOpenSci packages that have mainly been used by a handful of developers until now, one of them being rOpenSci co-founder Scott Chamberlain. Scott often uses `crul` in his API packages while we used `httr` for `rromeo`. Both `httr` and `crul` have very similar goals but slightly different philosophies. We were able to identify issues with [vcr] and [webmockr] when used with [httr].

We also plan to contact the SHERPA/RoMEO API developers to let them know we developed `rromeo` and have their feedback on the package.

### The future

`rromeo` is both on GitHub and CRAN now and seems quite stable as it is now. The SHERPA/RoMEO API offers more data regarding paid open access policies (<http://www.sherpa.ac.uk/romeo/PaidOA.php>) as well as other restrictions on manuscript archival. We haven't found yet a suitable format to returns these data to users, that's why `rromeo` doesn't use these data for the moment but we'll be glad to add more features to the package. If you want to get involved, we welcome contributions.

We enjoyed the experience of contributing to rOpenSci, benefiting from great recommendations by the editor and reviewers, as well as discovering bugs in lesser used packages along the way.

We are now moving to [another package](https://github.com/Rekyt/rtaxref) that we plan to submit to rOpenSci. It is also an API package so we'll be using some of the knowledge we got from developing `rromeo`. We hope to be back soon on the rOpenSci blog to talk about that ;)

### Acknowledgements

We would like to thank both of the reviewers Philipp Ottolinger (@ottlngr) and Bruna Wundervald (@brunaw) as well as the editor Scott Chamberlain (@sckott) for their input to improve the documentation and the package.
We also want to mention Scott Chamberlain for building so many in tools to make the interactions with API within R easier ([vcr], [webmockr], crul, as well as many API packages that can be used as examples for developing your own API package).

- [httr]: https://github.com/r-lib/httr
- [rredlist]: https://github.com/ropensci/rredlist
- [vcr]: https://github.com/ropensci/vcr
- [webmockr]: https://github.com/ropensci/webmockr
